spring:
    application:
        name: kanban-backend

    profiles:
        active: ${SPRING_PROFILES_ACTIVE:dev}

    flyway:
        enabled: false

    servlet:
        multipart:
            max-file-size: 5MB
            max-request-size: 5MB
            enabled: true

    cache:
        type: caffeine
        caffeine:
            spec: maximumSize=500,expireAfterWrite=5m

    security:
        oauth2:
            client:
                registration:
                    google:
                        client-id: ${GOOGLE_CLIENT_ID}
                        client-secret: ${GOOGLE_CLIENT_SECRET}
                        scope:
                            - openid
                            - email
                            - profile
                        redirect-uri: '{baseUrl}/login/oauth2/code/{registrationId}'
                        client-name: Google
                provider:
                    google:
                        authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
                        token-uri: https://oauth2.googleapis.com/token
                        user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
                        user-name-attribute: sub

    datasource:
        url: jdbc:postgresql://localhost:5432/kanban_db
        driver-class-name: org.postgresql.Driver
        username: root
        password: password!
        hikari:
            pool-name: HikariPool-Kanban
            auto-commit: false
            maximum-pool-size: 10
            minimum-idle: 5
            connection-timeout: 30000
            idle-timeout: 600000
            max-lifetime: 1800000
            leak-detection-threshold: 2000 # Detect leaks > 2s

    data:
        redis:
            host: ${REDIS_HOST:localhost}
            port: ${REDIS_PORT:6379}
            database: ${REDIS_DB:0}

    # H2 Console disabled
    h2:
        console:
            enabled: false
            path: /h2-console

    jpa:
        open-in-view: false
        database-platform: org.hibernate.dialect.PostgreSQLDialect
        hibernate:
            ddl-auto: update # Temporarily reverted from validate for troubleshooting
        show-sql: true
        properties:
            hibernate:
                format_sql: true
                use_sql_comments: true
                jdbc:
                    batch_size: 20
                order_inserts: true
                order_updates: true

    jackson:
        serialization:
            write-dates-as-timestamps: false
            indent-output: true
        deserialization:
            fail-on-unknown-properties: false
        time-zone: UTC

# Storage Configuration
storage:
    type: ${STORAGE_TYPE:local} # local, azure
    local:
        root-dir: uploads
    azure:
        account-name: ${AZURE_STORAGE_ACCOUNT_NAME:devstoreaccount1}
        account-key: ${AZURE_STORAGE_ACCOUNT_KEY:Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==}
        endpoint: ${AZURE_STORAGE_CONNECTION_STRING:UseDevelopmentStorage=true}
        container-name: ${AZURE_STORAGE_CONTAINER_NAME:kanban-master}

server:
    port: ${SERVER_PORT:8080}
    error:
        include-message: always
        include-binding-errors: always
        include-stacktrace: on_param
        include-exception: false
    compression:
        enabled: true
        mime-types: application/json,application/xml,text/html,text/xml,text/plain

# OpenAPI/Swagger Configuration
springdoc:
    api-docs:
        path: /v3/api-docs
    swagger-ui:
        path: /swagger-ui.html
        enabled: true
        operations-sorter: method
        tags-sorter: alpha
    show-actuator: false

# Logging Configuration
logging:
    pattern:
        console: '%d{yyyy-MM-dd HH:mm:ss.SSS} %highlight(%-5level) %magenta([%thread]) %cyan(%logger{36}) - %msg%n'
        file: '%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n'
    level:
        root: INFO
        com.kanban: DEBUG
        org.springframework.web: DEBUG
        org.springframework.security: DEBUG
        org.hibernate.SQL: DEBUG
        org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    file:
        name: logs/kanban-backend.log
        max-size: 10MB
        max-history: 30
        total-size-cap: 1GB

# Management & Actuator (optional, for production monitoring)
management:
    endpoints:
        web:
            exposure:
                include: health,info,metrics
    endpoint:
        health:
            show-details: when-authorized

security:
    jwt:
        secret-key: ${JWT_SECRET:dGhpc2lzYS1sb25nLWFuZC1zZWN1cmUtc3VwZXItc2VjcmV0LXN0cmluZw==}
        access-token-validity-seconds: 900
        refresh-token-validity-seconds: 1209600
        refresh-token-cookie-name: KANBAN_REFRESH_TOKEN

    # Cookie 기본 설정 (프로파일별로 덮어씀)
    cookie:
        secure: false
        same-site: Lax
        domain:

# File Upload Configuration
file:
    upload:
        path: ${FILE_UPLOAD_PATH:uploads/avatars}

# MailerSend Configuration
mailersend:
    api:
        token: ${MAILERSEND_API_TOKEN:aaa}
    from:
        email: ${MAILERSEND_FROM_EMAIL:no-reply@test-q3enl6k700742vwr.mlsender.net}
        name: ${MAILERSEND_FROM_NAME:Kanban Board}

# Application Configuration
app:
    frontend:
        url: ${FRONTEND_URL:http://localhost:3000}
