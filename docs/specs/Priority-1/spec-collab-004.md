# spec-collab-004 — 협업 및 활동 PRD

## 1. 개요
- 팀 협업 투명성을 위해 활동 로그, 권한, 알림 체계를 정의한다.
- 변경 이력과 사용자 초대 기능을 통합하여 보드 운영의 신뢰도를 높인다.

## 2. 연계 요구사항
- FR-09 활동 로그
- FR-10 사용자 초대 및 권한
- FR-11 알림

## 3. 사용자 시나리오
1. 프로젝트 리드가 보드 설정에서 팀원을 이메일로 초대하고 편집 권한을 부여한다.
2. 팀원이 카드 이동/댓글 작성 시 활동 로그에 자동으로 기록되어 다른 사용자가 히스토리를 확인한다.
3. 담당자 변경, 멘션 발생 시 관련 사용자에게 인앱 알림이 도착하고 알림 센터에서 읽음 처리한다.

## 4. 디자인 가이드라인
- **활동 로그**
  - 카드 상세 패널 하단과 보드 수준 패널 두 곳에 표시한다.
  - 아이콘 + 색상으로 이벤트 유형(생성, 이동, 댓글 등)을 구분한다.
  - “내 활동만 보기” 토글을 제공하여 필터링을 단순화한다.
- **권한/초대**
  - 보드 설정 패널에 사용자 리스트(아바타, 이름, 권한 라벨)를 표 형태로 보여주고, 권한 변경 드롭다운을 제공한다.
  - 초대 UI는 이메일 입력 + 초대 메시지 옵션, 초대 상태(보류/수락)를 표시한다.
- **알림**
  - 헤더에 알림 아이콘과 뱃지를 표시하며, 드롭다운 패널에서 최신 20개 알림을 보여준다.
  - 알림 항목은 아이콘, 요약 문구, 타임스탬프, “바로가기” 버튼을 포함한다.

## 5. 프론트엔드 규격
- **활동 로그 뷰어**
  - 타임라인 리스트 컴포넌트(`ActivityTimeline`), 무한 스크롤 또는 “더 보기” 버튼 제공.
  - 이벤트 항목 데이터: 작성자 아바타, 메시지, 상대 시간(예: 5분 전), 관련 카드 링크.
- **권한 관리**
  - `BoardMemberTable` 컴포넌트에서 사용자 검색, 권한 변경(보기/편집/관리자)을 인라인 셀 편집으로 처리한다.
  - 초대 폼은 다중 이메일 입력을 지원하고 결과를 배지 형태로 표시한다.
- **알림 센터**
  - 클라이언트는 SSE/WebSocket 또는 폴링을 통해 알림 피드를 수신한다.
  - 읽음 처리 시 로컬 상태와 서버 상태를 동기화하고, 전체 읽음 버튼을 제공한다.

## 6. 백엔드 규격
- **권한/초대**
  - `POST /api/v1/boards/{boardId}/members` (초대)
  - `PATCH /api/v1/boards/{boardId}/members/{memberId}` (권한 변경)
  - `DELETE /api/v1/boards/{boardId}/members/{memberId}` (제거)
  - 초대 토큰 만료 시간(예: 72시간)과 상태(보류/수락/만료)를 관리한다.
- **활동 로그**
  - 모든 주요 이벤트(보드/컬럼/카드 생성·수정·삭제, 권한 변경 등)를 이벤트 스트림에 기록.
  - `GET /api/v1/boards/{boardId}/activities` (페이지네이션), `GET /api/v1/cards/{cardId}/activities`.
- **알림**
  - 트리거 조건: 담당자 변경, 멘션, 마감 임박.
  - `GET /api/v1/notifications`, `POST /api/v1/notifications/{id}/read`.
  - 알림 데이터는 유형, 메시지, 관련 리소스 ID, 읽음 여부를 포함한다.

## 7. 수용 기준
1. 보드에 멤버를 초대하면 상대가 수락하기 전까지 “보류” 상태로 표시된다.
2. 권한 변경 시 즉시 적용되고, 권한 부족 사용자는 편집 기능을 사용할 수 없다.
3. 활동 로그는 최근 50개 이벤트를 기본으로 보여주고, 더 보기를 통해 과거 기록을 로드한다.
4. 알림 아이콘 뱃지는 읽지 않은 알림 수를 나타내며, 드롭다운에서 “모두 읽음”을 선택하면 뱃지가 사라진다.

## 8. 구현 순서
1. 백엔드: 권한 모델·활동 로그 저장소·알림 큐 구축.
2. 프론트엔드: 멤버 관리 UI → 활동 로그 뷰어 → 알림 센터 순서로 개발.
3. 실시간 업데이트: SSE/WebSocket 또는 알림 전용 폴링으로 변경 사항을 전파.
