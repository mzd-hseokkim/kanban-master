# spec-auth-000 — 인증·세션 PRD

## 1. 개요
- Modern Kanban Service를 사용하는 모든 사용자는 안전하게 로그인하고, 권한 범위 내 리소스만 접근할 수 있어야 한다.
- 인증 계층은 이후의 모든 기능 개발에 선행되어야 하며, 워크스페이스·보드 권한 검증의 기반이 된다.

## 2. 연계 요구사항
- FR-00 인증 및 세션 관리
- FR-00b 권한 토대 구축

## 3. 사용자 시나리오
1. 조직 계정(이메일/비밀번호)으로 로그인하여 대시보드에 접근한다.
2. 세션 만료 또는 로그아웃 후에는 다시 로그인 화면으로 리다이렉션된다.
3. 권한이 없는 보드 URL을 직접 입력하면 접근 거부 메시지를 확인한다.

## 4. 디자인 가이드라인
- 로그인 화면은 글래스모피즘 테마를 유지하되, 입력 필드 두 개(이메일, 비밀번호)와 “로그인” CTA만 배치하여 단순하게 유지한다.
- 에러 메시지는 입력 필드 아래 인라인으로 표시하고, 상단에는 보안 안내 문구(“조직 계정을 사용하십시오”)를 배치한다.
- 세션 만료 시 토스트로 “세션이 만료되어 다시 로그인해야 합니다” 안내 후 로그인 페이지로 전환한다.
- 보드 접근 거부 페이지는 403 일러스트 + “워크스페이스 관리자에게 요청하세요” 문구를 제공한다.

## 5. 프론트엔드 규격
- **라우팅**
  - `/login`: 비인증 접근 허용.
  - `/*`: 보호 라우트, 토큰이 없거나 만료된 경우 `/login`으로 이동.
- **상태 저장**
  - JWT 또는 세션 토큰을 `HttpOnly` 쿠키로 유지하고, 프론트 상태에는 최소한의 사용자 정보만 저장한다.
  - 현재 사용자 정보(API `/me`)를 전역 상태에 캐싱하여 보드 권한 판단에 활용한다.
- **에러 처리**
  - 401 응답 시 토큰 제거 후 로그인 화면으로 이동.
  - 403 응답 시 페이지 내 안내 메시지 + “다른 보드 보기” 버튼.

## 6. 백엔드 규격
- **엔드포인트**
  - `POST /api/v1/auth/login`: 이메일·비밀번호 검증 후 액세스 토큰/리프레시 토큰 발급.
  - `POST /api/v1/auth/refresh`: 리프레시 토큰을 검증하고 새 액세스 토큰 발급.
  - `POST /api/v1/auth/logout`: 리프레시 토큰 무효화.
  - `GET /api/v1/auth/me`: 현재 사용자 기본 프로필과 워크스페이스/보드 권한 목록 반환.
- **보안 정책**
  - 비밀번호는 Bcrypt 이상으로 해시.
  - 액세스 토큰 만료 15분, 리프레시 토큰 만료 14일(예시)로 설정.
  - 모든 `/api/v1/**` 요청은 필터에서 JWT 검증 후 `SecurityContext`에 사용자·권한을 주입한다.
- **권한 모듈**
  - 워크스페이스 단위의 기본 역할(Owner/Admin/Member) + 보드 단위 역할(BoardMember.role)을 함께 평가.
  - 요청 리소스가 보드 ID를 포함할 경우, BoardMember 또는 상위 워크스페이스 권한을 확인한다.

## 7. 수용 기준
1. 올바른 자격 증명으로 로그인하면 액세스 토큰이 발급되고 보호 라우트에 접근할 수 있다.
2. 토큰이 만료된 상태에서 보호 API를 호출하면 401을 받고, 프론트는 자동으로 로그인 페이지로 이동한다.
3. 권한이 없는 보드 ID로 API를 호출하면 403을 반환한다.
4. 로그아웃 시 모든 토큰이 무효화되고, 새 토큰 없이 API 호출 시 401을 받는다.

## 8. 구현 순서
1. 백엔드 인증/인가 필터, 토큰 발급 로직, 사용자/역할 저장소 구현.
2. 프론트 로그인·보호 라우트·세션 만료 처리.
3. 보드/카드 API에 권한 검증 미들웨어 적용 및 통합 테스트 작성.
