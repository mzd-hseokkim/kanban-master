# Priority 2 요구사항 – 카드 댓글 기능

## 목적

칸반 보드의 협업 기능 향상을 위해 **카드마다 사용자 댓글(Comment)을 작성, 조회, 수정, 삭제**할 수 있도록 하여 팀원 간 원활한 의사소통과 작업 내역 추적을 가능하게 한다.

## 범위

- **포함**: 카드별 댓글 작성/조회/수정/삭제, 카드 상세 모달에 댓글 섹션 통합, 댓글 목록 페이지네이션, 작성자 정보 표시, 권한 기반 수정/삭제, Activity 로그 연동, XSS 방지 처리, RichTextEditor 통합, 댓글 개수 표시, 수정 이력 관리, Soft delete.
- **제외**: 대댓글(스레드), @mention 기능, 댓글 알림, 댓글 반응/좋아요, 첨부파일, 실시간 업데이트(Phase 1에서 제외, 추후 추가 예정), 댓글 검색.

## 기능 요구사항

| ID | 제목 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-06a | 댓글 작성 | 보드 멤버(VIEWER 이상)가 카드에 댓글을 작성할 수 있다. | Must |
| FR-06b | 댓글 목록 조회 | 카드에 작성된 모든 댓글을 최신순으로 조회할 수 있다. | Must |
| FR-06c | 댓글 수정 | 댓글 작성자 본인만 자신의 댓글을 수정할 수 있다. | Must |
| FR-06d | 댓글 삭제 | 댓글 작성자 또는 보드 OWNER가 댓글을 삭제할 수 있다. | Must |
| FR-06e | 작성자 정보 표시 | 각 댓글에 작성자의 이름, 이메일, 아바타, 작성 시간을 표시한다. | Must |
| FR-06f | 페이지네이션 | 댓글이 많을 경우 페이지네이션을 제공한다 (기본 20개/페이지). | Should |
| FR-06g | 빈 댓글 방지 | 빈 내용의 댓글은 작성할 수 없다. | Must |
| FR-06h | Activity 로그 | 댓글 작성/삭제 시 Activity에 COMMENT_ADDED/COMMENT_DELETED 이벤트를 기록한다. | Should |
| FR-06i | XSS 방지 | 댓글 내용에 악의적인 스크립트 삽입을 방지한다. | Must |
| FR-06j | 카드 상세 모달 UI 통합 | 카드 상세 모달을 2-column 레이아웃으로 변경하여 우측에 댓글 섹션을 배치한다. | Must |
| FR-06k | RichTextEditor 통합 | 댓글 입력 시 RichTextEditor를 사용하여 서식 있는 텍스트를 작성할 수 있다. | Must |
| FR-06l | 댓글 개수 표시 | 카드 목록 아이템에 댓글 개수 뱃지를 표시한다. | Should |
| FR-06m | 수정 이력 표시 | 댓글이 수정된 경우 "(수정됨)" 표시와 함께 수정 시간을 표시한다. | Should |
| FR-06n | Soft Delete | 댓글 삭제 시 DB에서 완전히 제거하지 않고 isDeleted 플래그로 관리한다. | Must |

## UX·인터랙션 요구사항

1. **직관적인 댓글 UI**: 카드 상세 모달 우측에 독립적인 댓글 섹션이 명확하게 구분되어야 한다.
2. **댓글 입력 편의성**: 댓글 입력 영역은 항상 상단에 고정되어 쉽게 접근할 수 있어야 한다.
3. **즉시 반영**: 댓글 작성/수정/삭제 후 즉시 UI에 반영되어야 한다.
4. **작성자 구분**: 현재 사용자의 댓글과 다른 사용자의 댓글을 시각적으로 구분한다.
5. **편집/삭제 권한 표시**: 본인 댓글에만 편집/삭제 버튼이 표시되어야 한다 (OWNER는 모든 댓글 삭제 가능).
6. **모바일 반응형**: 화면 너비 < 1024px에서 단일 컬럼으로 전환되어 댓글이 카드 정보 아래에 배치된다.
7. **로딩 상태**: 댓글 로딩 중 스켈레톤 UI를 표시한다.
8. **빈 상태**: 댓글이 없을 때 "아직 댓글이 없습니다" 메시지를 표시한다.

## 비기능 요구사항

| 항목 | 기준 |
|------|------|
| 성능 | 댓글 목록 조회 < 300ms, 댓글 작성/수정/삭제 < 500ms |
| 신뢰성 | 댓글 작성 실패 시 사용자에게 명확한 에러 메시지 제공 |
| 보안 | XSS 공격 방지를 위한 HTML sanitization, 권한 기반 수정/삭제 제어 |
| 호환성 | 모던 브라우저(Chrome, Firefox, Safari, Edge) 지원 |
| 접근성 | WCAG 2.1 AA 준수, 키보드 네비게이션 지원 |
| 데이터 제한 | 댓글 내용 최대 길이 10,000자 |

## 가정 및 제약

- 댓글 내용은 RichTextEditor를 통해 HTML 포맷으로 저장하며, 카드 설명과 동일한 편집 경험을 제공한다.
- 대댓글(스레드) 기능은 현재 범위에서 제외하며, 향후 Priority-3에서 고려한다.
- @mention 기능과 실시간 알림은 별도 요구사항으로 다룬다.
- 댓글 삭제는 Soft delete 방식을 사용한다 (isDeleted 플래그로 관리, GDPR 대응).
- 삭제된 댓글은 UI에서 숨겨지며, OWNER는 복구 기능을 사용할 수 있다 (선택사항).
- 댓글은 카드가 삭제되어도 DB에 유지되며, 카드 복구 시 함께 복구된다.
- 카드 상세 모달의 최대 너비를 확장하여 2-column 레이아웃을 수용한다.
- 실시간 업데이트는 Phase 1에서 제외하고, 추후 WebSocket 또는 폴링으로 구현한다.
- 페이지네이션은 offset 기반을 사용한다 (page, size 파라미터).

## 확정된 결정 사항

1. ✅ **댓글 입력 방식**: RichTextEditor 사용 (카드 설명과 일관된 편집 경험)
2. ✅ **실시간 업데이트**: Phase 1에서 제외, 추후 WebSocket 또는 폴링으로 구현
3. ✅ **댓글 개수 표시**: 카드 목록 아이템에 댓글 개수 뱃지 표시
4. ✅ **수정 이력 표시**: 댓글 수정 시 "(수정됨)" 표시 및 updatedAt 시간 표시
5. ✅ **삭제 방식**: Soft delete (isDeleted 플래그, GDPR 대응)
6. ✅ **페이지네이션**: Offset 기반 (page, size 파라미터)

## 미해결 이슈

1. 삭제된 댓글의 복구 기능을 OWNER에게 제공할지 여부를 결정해야 한다.
2. 댓글 개수 뱃지의 색상 및 표시 위치(카드 하단 vs. 우측 상단)를 확정해야 한다.
3. RichTextEditor의 허용 태그 범위를 카드 설명과 동일하게 할지, 더 제한할지 결정해야 한다.
4. 댓글이 100개 이상일 때 무한 스크롤을 적용할지 "더 보기" 버튼을 유지할지 결정해야 한다.
