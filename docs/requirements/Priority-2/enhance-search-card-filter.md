# Priority 2 요구사항 – 검색 필터 개선: "내게 할당된 카드" 기능 추가

## 1. 목적과 범위

### 목적

칸반 보드의 검색 기능을 개선하여 **현재 로그인한 사용자에게 할당된 카드만 빠르게 필터링**할 수 있는 기능을 제공함으로써, 개인 작업 관리 효율성을 향상시키고 사용자 경험을 개선한다.

### 비즈니스 목표

- **생산성 향상**: 사용자가 자신의 작업(할당된 카드)에 집중할 수 있도록 지원
- **검색 효율성 증대**: 다수의 카드 중에서 자신의 작업만 신속하게 확인 가능
- **사용자 경험 개선**: 직관적인 필터 UI로 작업 관리 편의성 제공
- **협업 효율성**: 팀 환경에서 개인 작업과 전체 작업을 쉽게 구분

### 범위

- **포함**:
  - 검색 패널에 "내게 할당된 카드" 체크박스 필터 추가
  - 백엔드 검색 API에 `assignedToMe` 파라미터 추가
  - 현재 로그인 사용자 정보를 기반으로 한 카드 필터링 로직
  - 기존 필터(우선순위, 라벨, 상태 등)와의 조합 검색 지원

- **제외**:
  - 다른 사용자에게 할당된 카드 조회 (향후 확장)
  - 카드 할당 기능 자체의 개선 (별도 요구사항)
  - 팀/그룹 단위 필터링 (Priority 3 이상)
  - 할당 이력 조회 (Priority 3 이상)

---

## 2. 이해관계자

### 사용자 페르소나

#### 페르소나 1: 프로젝트 개발자 (김철수)
- **역할**: 소프트웨어 개발자, 여러 프로젝트에서 동시에 작업
- **목표**: 자신에게 할당된 작업만 빠르게 확인하여 우선순위 관리
- **니즈**:
  - 전체 보드에서 내 작업만 필터링
  - 우선순위가 높은 내 작업 우선 확인
  - 마감 기한이 임박한 내 작업 빠른 식별

#### 페르소나 2: 프로젝트 매니저 (이영희)
- **역할**: 프로젝트 관리자, 팀원들의 작업 분배 및 진행 상황 모니터링
- **목표**: 자신이 직접 처리해야 할 관리 작업과 팀원 작업 구분
- **니즈**:
  - 내 작업과 전체 작업을 쉽게 전환하며 확인
  - 자신의 검토/승인이 필요한 카드만 필터링
  - 미완료된 내 작업 현황 파악

#### 페르소나 3: QA 엔지니어 (박민수)
- **역할**: 품질 관리 담당자, 다수의 테스트 작업 처리
- **목표**: 자신에게 할당된 테스트 작업만 집중하여 처리
- **니즈**:
  - 대량의 카드 중에서 내 테스트 작업만 조회
  - 지연된 내 작업 빠르게 확인
  - 완료된 작업과 미완료 작업 구분

### 주요 역할

| 역할 | 책임 | 이해관계 |
|------|------|----------|
| 엔드 사용자 | 검색 필터를 활용하여 자신의 작업 관리 | 직관적이고 빠른 필터링 경험 |
| 프로젝트 매니저 | 팀 작업과 개인 작업 모니터링 | 효율적인 작업 가시성 확보 |
| 개발 팀 | 기능 구현 및 유지보수 | 확장 가능하고 성능이 우수한 아키텍처 |
| 운영 팀 | 시스템 안정성 및 성능 관리 | 최소한의 시스템 부하로 기능 제공 |

---

## 3. 기능 요구사항

### 3.1 핵심 기능

| ID | 제목 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-06a | "내게 할당된 카드" 체크박스 UI | 검색 패널의 필터 영역에 "내게 할당된 카드" 체크박스를 추가한다 | Must |
| FR-06b | 체크박스 상태 관리 | 체크박스의 선택/해제 상태를 관리하고 검색 요청에 반영한다 | Must |
| FR-06c | 백엔드 필터링 로직 | 현재 로그인한 사용자의 정보를 기반으로 할당된 카드만 조회한다 | Must |
| FR-06d | 기존 필터와의 조합 | 우선순위, 라벨, 상태 등 기존 필터와 함께 사용 가능하도록 AND 조건으로 처리한다 | Must |
| FR-06e | 필터 초기화 | "필터 초기화" 버튼 클릭 시 "내게 할당된 카드" 체크박스도 해제된다 | Must |
| FR-06f | 검색 결과 업데이트 | 체크박스 선택 후 "검색" 버튼 클릭 시 필터가 적용된 결과를 표시한다 | Must |

### 3.2 상세 동작 명세

#### 3.2.1 프론트엔드 동작

1. **초기 상태**
   - 검색 패널 열림 시 체크박스는 기본적으로 해제 상태
   - 체크박스는 "상태" 필터 섹션에 위치

2. **사용자 상호작용**
   - 사용자가 체크박스를 선택하면 `assignedToMe` 상태가 `true`로 설정
   - 체크박스를 해제하면 `assignedToMe` 상태가 `false`로 설정
   - "검색" 버튼 클릭 시 현재 모든 필터 조건을 포함한 검색 요청 전송

3. **검색 요청 구성**
   - `CardSearchRequest` 객체에 `assignedToMe: boolean` 필드 포함
   - 체크박스가 선택된 경우에만 `assignedToMe: true`를 API에 전달
   - 해제 상태인 경우 해당 필드를 전송하지 않음 (또는 `false`)

4. **필터 초기화**
   - "필터 초기화" 버튼 클릭 시 모든 필터 상태와 함께 체크박스도 해제
   - 검색 결과도 초기화

#### 3.2.2 백엔드 동작

1. **요청 파라미터 수신**
   - `CardSearchRequest` DTO에 `assignedToMe: Boolean` 필드 추가
   - 요청 파라미터에서 `assignedToMe` 값을 수신

2. **사용자 인증 정보 조회**
   - `SecurityUtil.getCurrentUserId()`를 통해 현재 로그인한 사용자 ID 조회
   - `UserRepository`를 통해 사용자 정보(email, name) 조회
   - 사용자 정보가 없는 경우 예외 처리

3. **필터링 로직**
   - `assignedToMe`가 `true`인 경우:
     - 현재 사용자의 email 또는 name과 Card.assignee 필드 매칭
     - `OR` 조건으로 email 또는 name 중 하나라도 일치하면 포함
   - `assignedToMe`가 `false` 또는 `null`인 경우:
     - 해당 필터를 적용하지 않음 (전체 카드 대상)

4. **기존 필터와의 조합**
   - 기존 필터 조건(우선순위, 라벨, 상태 등)과 `AND` 조건으로 결합
   - 모든 필터 조건을 만족하는 카드만 결과에 포함

---

## 4. 비기능 요구사항

### 4.1 성능 요구사항

| 항목 | 기준 | 측정 방법 |
|------|------|----------|
| 검색 응답 시간 | < 200ms (평균) | 카드 1000개 기준, 모든 필터 조합 |
| 체크박스 반응 시간 | < 50ms | 클릭부터 UI 상태 변경까지 |
| 검색 결과 렌더링 | < 500ms | 결과 수신부터 화면 표시까지 |
| 동시 검색 요청 처리 | 100 req/sec | 사용자 100명 동시 검색 시나리오 |

### 4.2 보안 요구사항

| 항목 | 요구사항 | 구현 방법 |
|------|----------|----------|
| 인증 확인 | 로그인하지 않은 사용자는 기능 사용 불가 | JWT 토큰 검증, SecurityContext 확인 |
| 권한 검증 | 사용자는 자신의 정보로만 필터링 가능 | 백엔드에서 SecurityUtil로 사용자 ID 추출 |
| SQL Injection 방지 | 사용자 입력값에 대한 안전한 쿼리 처리 | JPA Criteria API 사용, 파라미터 바인딩 |
| 데이터 노출 방지 | 다른 사용자의 할당 정보 노출 금지 | 현재 사용자 정보만 사용 |

### 4.3 신뢰성 요구사항

- **데이터 정확성**: 현재 사용자에게 할당된 카드만 정확하게 조회
- **에러 핸들링**:
  - 사용자 정보 조회 실패 시 명확한 오류 메시지 반환
  - 네트워크 오류 시 사용자에게 재시도 안내
- **상태 일관성**: 필터 상태와 검색 결과가 항상 일치

### 4.4 확장성 요구사항

- **데이터 확장성**: 카드 수가 증가해도 성능 저하 최소화 (인덱스 활용)
- **기능 확장성**: 향후 팀/그룹 단위 필터링으로 확장 가능한 구조
- **코드 확장성**: 새로운 필터 조건 추가가 용이한 아키텍처

### 4.5 호환성 요구사항

- **브라우저**: Chrome, Firefox, Safari, Edge 최신 2개 버전 지원
- **모바일**: 반응형 디자인으로 모바일 기기에서도 체크박스 사용 가능
- **API 버전**: 기존 검색 API와 하위 호환성 유지

### 4.6 접근성 요구사항

- **키보드 네비게이션**: Tab 키로 체크박스 포커스 이동 가능
- **스크린 리더**: 체크박스에 명확한 레이블 제공 ("내게 할당된 카드")
- **시각적 피드백**: 체크박스 선택 상태가 명확하게 구분되어야 함

---

## 5. UI/UX 요구사항

### 5.1 화면 구성

#### 5.1.1 검색 패널 레이아웃

```
┌─────────────────────────────────────────┐
│  Smart Search                       ✕   │
│  카드 검색                               │
├─────────────────────────────────────────┤
│  [검색어 입력...........] 🔍필터 [검색] │
├─────────────────────────────────────────┤
│  ▼ 우선순위                             │
│     [HIGH] [MEDIUM] [LOW]               │
│                                         │
│  ▼ 라벨                                 │
│     [라벨1] [라벨2] [라벨3]             │
│                                         │
│  ▼ 상태                                 │
│     [완료] [미완료] [지연됨]            │
│     ☐ 내게 할당된 카드                  │  ← 새로 추가
│                                         │
│     [♻️ 필터 초기화]                    │
├─────────────────────────────────────────┤
│  검색 결과...                           │
└─────────────────────────────────────────┘
```

#### 5.1.2 체크박스 위치

- **위치**: "상태" 필터 섹션 내, 기존 버튼([완료], [미완료], [지연됨]) 아래
- **정렬**: 왼쪽 정렬, 다른 필터 요소들과 일관된 간격 유지
- **순서**: 상태 버튼들 다음, "필터 초기화" 버튼 이전

### 5.2 상호작용 방식

#### 5.2.1 체크박스 동작

1. **초기 상태**
   - 검색 패널 열릴 때: 체크 해제 상태
   - 체크박스 옆 레이블: "내게 할당된 카드"

2. **선택 시**
   - 체크박스 클릭 → 체크 표시 (✓)
   - 시각적 강조 (예: 배경색 변경, 테두리 하이라이트)
   - 즉시 상태 업데이트 (별도 확인 불필요)

3. **검색 실행**
   - "검색" 버튼 클릭 시 현재 체크 상태를 포함하여 검색
   - Enter 키로도 검색 실행 가능

4. **필터 초기화**
   - "필터 초기화" 버튼 클릭 → 체크박스 해제
   - 다른 필터들과 동시에 초기화

#### 5.2.2 피드백 메커니즘

- **로딩 상태**: 검색 중 "검색 중..." 표시
- **결과 없음**: "검색 결과가 없습니다" 메시지
- **오류 발생**: 명확한 오류 메시지와 재시도 안내

### 5.3 화면 흐름

```
[검색 패널 열기]
      ↓
[필터 조건 설정]
  - 키워드 입력
  - 우선순위 선택
  - 라벨 선택
  - 상태 선택
  - ☑ 내게 할당된 카드 체크  ← 새 단계
      ↓
[검색 버튼 클릭]
      ↓
[검색 API 호출]
  - assignedToMe: true 포함
      ↓
[결과 표시]
  - 내 카드만 표시
      ↓
[카드 선택 시]
  - 해당 카드로 이동
  - 검색 패널 닫힘
```

### 5.4 스타일 가이드

#### 5.4.1 체크박스 스타일

- **크기**: 18x18px (터치 친화적)
- **색상**:
  - 미선택: 테두리 pastel-blue-300, 배경 흰색
  - 선택: 배경 pastel-blue-500, 체크 표시 흰색
  - Hover: 테두리 pastel-blue-500
- **레이블**:
  - 폰트: 14px, font-medium
  - 색상: pastel-blue-900
  - 간격: 체크박스와 8px

#### 5.4.2 반응형 디자인

- **데스크톱**: 체크박스와 레이블 한 줄 배치
- **태블릿**: 동일
- **모바일**: 동일, 터치 영역 확장 (최소 44x44px)

---

## 6. 제약사항

### 6.1 기술적 제약사항

| 제약사항 | 내용 | 영향 |
|----------|------|------|
| Card.assignee 데이터 타입 | 현재 String 타입 (User FK 아님) | 문자열 매칭 필요, email 또는 name으로 비교 |
| 사용자 정보 조회 필요 | 매 검색 시 User 엔티티 조회 | 추가 DB 쿼리, 성능 고려 필요 |
| 기존 API 구조 유지 | 검색 API 엔드포인트 변경 불가 | 파라미터 추가 방식으로만 구현 |
| 하위 호환성 | 기존 검색 기능 정상 동작 보장 | assignedToMe가 없어도 정상 작동 |

### 6.2 비즈니스 제약사항

| 제약사항 | 내용 | 이유 |
|----------|------|------|
| 단일 담당자만 지원 | 카드당 1명의 담당자만 가능 | Card.assignee가 String 단일 필드 |
| 자신의 카드만 필터링 | 다른 사용자 카드 필터링 불가 | 현재 요구사항 범위, 향후 확장 가능 |
| 인증 필수 | 로그인하지 않은 사용자 사용 불가 | 현재 사용자 정보 필요 |

### 6.3 데이터 제약사항

- **assignee 필드 형식**:
  - 현재 사용자의 email 또는 name과 정확히 일치해야 함
  - 대소문자 구분 여부는 DB 설정에 따름
  - null 값인 카드는 결과에서 제외

### 6.4 환경 제약사항

- **개발 환경**: H2 데이터베이스 사용
- **프로덕션 환경**: PostgreSQL 사용
- **인증 방식**: JWT 기반 인증
- **프론트엔드**: React 19, Vite, Tailwind CSS

---

## 7. 용어 정리 / 용어 사전

| 용어 | 정의 | 비고 |
|------|------|------|
| assignee | 카드에 할당된 담당자 (String) | 사용자의 email 또는 name 저장 |
| assignedToMe | "내게 할당된 카드" 필터 여부 (Boolean) | 검색 요청 파라미터 |
| CardSearchRequest | 카드 검색 요청 DTO | 프론트엔드/백엔드 모두 사용 |
| CardSearchResult | 카드 검색 결과 DTO | 검색 결과로 반환되는 카드 정보 |
| SecurityUtil | 현재 인증된 사용자 정보 조회 유틸리티 | getCurrentUserId() 메서드 제공 |
| SecurityContext | Spring Security의 인증 정보 컨텍스트 | 현재 사용자 정보 보관 |
| JWT | JSON Web Token | 사용자 인증에 사용되는 토큰 |
| UserProfile | 프론트엔드 사용자 프로필 타입 | AuthContext에서 제공 |
| 필터 초기화 | 모든 검색 필터를 기본 상태로 되돌림 | "♻️ 필터 초기화" 버튼 |
| 검색 패널 | 카드 검색 모달 UI | SearchPanel 컴포넌트 |
| Criteria API | JPA에서 타입 세이프한 쿼리 작성 API | 동적 쿼리 생성에 사용 |
| Predicate | 쿼리 조건을 나타내는 객체 | AND/OR 조건 조합에 사용 |

---

## 8. 가정 및 전제조건

### 8.1 가정

1. **사용자 인증**:
   - 모든 검색 요청은 인증된 사용자만 수행
   - JWT 토큰이 유효하며 SecurityContext에 사용자 정보 존재

2. **데이터 일관성**:
   - Card.assignee 필드는 User의 email 또는 name 중 하나와 일치
   - 사용자 정보(email, name)는 변경되지 않거나, 변경 시 카드의 assignee도 업데이트됨

3. **성능**:
   - Card 테이블에 assignee 컬럼에 대한 인덱스 존재
   - User 테이블 조회는 캐싱되거나 충분히 빠름

### 8.2 전제조건

1. **백엔드**:
   - Spring Security 설정 완료
   - UserRepository 사용 가능
   - SecurityUtil.getCurrentUserId() 정상 작동

2. **프론트엔드**:
   - AuthContext 정상 작동
   - useAuth() 훅으로 사용자 정보 접근 가능
   - SearchPanel 컴포넌트 존재

3. **데이터베이스**:
   - Card 테이블과 User 테이블 존재
   - assignee 필드에 인덱스 생성 권장

---

## 9. 구현 우선순위

| 순위 | 항목 | 이유 |
|------|------|------|
| P0 (Must) | 백엔드 DTO 및 필터링 로직 | 핵심 기능, 다른 작업의 기반 |
| P0 (Must) | 프론트엔드 타입 정의 및 서비스 수정 | 백엔드와 통신 필수 |
| P0 (Must) | UI 체크박스 추가 및 상태 관리 | 사용자 인터페이스 제공 |
| P1 (Should) | 에러 처리 및 예외 상황 대응 | 안정성 향상 |
| P1 (Should) | 성능 최적화 (캐싱, 인덱싱) | 사용자 경험 개선 |
| P2 (Could) | 접근성 개선 (ARIA 레이블) | 접근성 향상 |
| P2 (Could) | 모바일 반응형 최적화 | 모바일 사용성 향상 |

---

## 10. 성공 지표

### 10.1 정량적 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 검색 응답 시간 | < 200ms | 성능 모니터링 도구 |
| 기능 사용률 | > 30% (검색 사용자 중) | 분석 로그 |
| 오류 발생률 | < 0.1% | 에러 로그 분석 |
| 사용자 만족도 | > 4.0/5.0 | 사용자 피드백 설문 |

### 10.2 정성적 지표

- 사용자 피드백에서 "작업 관리가 쉬워졌다"는 평가
- 고객 지원 문의 중 "내 작업 찾기" 관련 문의 감소
- 검색 기능 사용 빈도 증가

---

## 11. 향후 확장 계획

### 11.1 단기 확장 (Priority 3)

- 다른 사용자에게 할당된 카드 조회 (담당자 선택 드롭다운)
- 여러 담당자 동시 선택 (다중 선택)
- 할당되지 않은 카드 필터링

### 11.2 중기 확장

- 팀/그룹 단위 필터링
- 할당 이력 조회 및 변경 추적
- Card.assignee를 User FK로 리팩토링 (데이터 무결성 향상)

### 11.3 장기 확장

- AI 기반 작업 추천 (사용자에게 적합한 카드 제안)
- 작업 부하 분석 (담당자별 작업량 시각화)
- 자동 할당 기능 (워크로드 기반)

---

## 12. 미해결 이슈

1. **Card.assignee 데이터 형식**:
   - 현재 email을 저장하는지, name을 저장하는지 확인 필요
   - 실제 데이터 샘플 검토 필요
   - 향후 User FK로 변경 고려

2. **성능 최적화**:
   - User 엔티티 조회 캐싱 전략 수립
   - assignee 컬럼 인덱스 생성 여부 확인

3. **다국어 지원**:
   - "내게 할당된 카드" 레이블의 다국어 번역
   - i18n 리소스 추가 여부

4. **접근성**:
   - ARIA 레이블 상세 명세
   - 키보드 단축키 지원 여부 (예: Alt+M)

5. **모바일 최적화**:
   - 작은 화면에서 체크박스 터치 영역 확장 정도
   - 필터 섹션 접기/펼치기 기능 추가 여부

---

## 13. 참고 자료

- [기존 검색 기능 명세서](./card-search-functionality.md) (존재 시)
- [Card 엔티티 스키마](../../backend/src/main/java/com/kanban/card/Card.java)
- [User 엔티티 스키마](../../backend/src/main/java/com/kanban/user/User.java)
- [SearchPanel 컴포넌트](../../frontend/src/components/SearchPanel.tsx)
- [Spring Security 설정](../../backend/src/main/java/com/kanban/config/SecurityConfig.java)
- [JWT 인증 필터](../../backend/src/main/java/com/kanban/filter/JwtAuthenticationFilter.java)

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 2025-01-14 | 1.0 | 초기 요구사항 문서 작성 | - |
