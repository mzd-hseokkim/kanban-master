# Priority 2 요구사항 – Card Hierarchy Support (부모-자식 카드 연결)

## 목적

칸반 보드의 작업 관리 효율성을 높이기 위해 **카드 간 부모-자식 계층 구조**를 지원한다. 사용자는 특정 카드 내에서 하위 카드를 생성하고, 카드 상세 모달에서 부모-자식 관계를 탐색할 수 있다. 이를 통해 복잡한 작업을 세부 작업으로 분해하고, 계층적 구조로 시각화할 수 있다.

## 범위

- **포함**:
  - 부모-자식 카드 관계 데이터 모델 구축 (Self-Referential 관계)
  - 카드 상세 모달에서 부모 카드 정보 표시 및 네비게이션
  - 카드 상세 모달에서 자식 카드 목록 표시 및 네비게이션
  - 모달 내 "하위 카드 생성" 기능
  - 모달 내에서 부모↔자식 카드 간 클릭 네비게이션 (모달 데이터 교체)
  - 부모 카드 삭제 시 자식 카드 처리 정책 (승격 방식)
  - 자식 카드 개수 표시 (카드 아이템)

- **제외**:
  - 2단계 이상의 깊은 계층 구조 (1단계 부모-자식만 지원)
  - 다중 부모 지원 (1개의 부모만 가능)
  - 계층 구조 시각화 (트리 다이어그램)
  - 자식 카드 드래그 앤 드롭 순서 변경
  - 순환 참조 자동 탐지 (1단계 제한으로 불필요)

## 기능 요구사항

| ID | 제목 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-06a | 부모-자식 관계 데이터 모델 | Card Entity에 parentCard 필드(Self-Referential ManyToOne)를 추가하여 부모 카드를 참조한다. | Must |
| FR-06b | 부모 카드 정보 표시 | 자식 카드의 상세 모달에서 부모 카드의 제목, 우선순위, 담당자 정보를 표시한다. | Must |
| FR-06c | 부모 카드 네비게이션 | 자식 카드 모달에서 부모 카드 링크를 클릭하면 모달의 데이터가 부모 카드로 전환된다. | Must |
| FR-06d | 자식 카드 목록 표시 | 부모 카드의 상세 모달에서 자식 카드 목록(제목, 완료 상태, 우선순위)을 표시한다. | Must |
| FR-06e | 자식 카드 네비게이션 | 부모 카드 모달에서 자식 카드를 클릭하면 모달의 데이터가 해당 자식 카드로 전환된다. | Must |
| FR-06f | 하위 카드 생성 버튼 | 카드 상세 모달에서 "하위 카드 생성" 버튼을 클릭하면 CreateCardModal이 열리고 부모 카드가 자동 설정된다. | Must |
| FR-06g | 자식 개수 표시 | 카드 아이템(CardItem)에 자식 카드 개수를 아이콘과 함께 표시한다 (예: "📎 3"). | Should |
| FR-06h | 부모 카드 삭제 시 자식 승격 | 부모 카드를 삭제하면 자식 카드의 parentCard가 null로 설정되어 최상위 카드로 승격된다. | Must |
| FR-06i | 자식 카드 이동 시 관계 해제 | 자식 카드를 다른 칼럼으로 이동하면 부모 관계가 자동 해제된다. | Should |
| FR-06j | 계층 제한 검증 | 카드 생성 시 이미 자식인 카드를 부모로 설정하려는 경우 에러를 반환한다 (1단계 제한). | Must |
| FR-06k | 권한 검증 | 하위 카드 생성 시 부모 카드가 속한 보드의 편집 권한을 확인한다. | Must |

## UX·인터랙션 요구사항

1. **직관적인 관계 표시**: 부모/자식 카드 정보는 카드 상세 모달의 명확한 위치(상단 또는 하단)에 시각적으로 구분되어 표시된다.
2. **클릭 가능한 링크**: 부모 카드 링크와 자식 카드 아이템은 호버 시 배경색 변경 등으로 클릭 가능함을 명확히 표시한다.
3. **부드러운 전환**: 카드 네비게이션 시 페이드 인/아웃 애니메이션(300ms)을 적용하여 자연스러운 UX를 제공한다.
4. **로딩 상태**: 카드 데이터 로딩 중 스피너를 표시하여 사용자에게 피드백을 제공한다.
5. **빈 상태 메시지**: 자식 카드가 없는 경우 "하위 카드가 없습니다. 첫 하위 카드를 생성해보세요!" 안내 메시지를 표시한다.
6. **키보드 네비게이션**: 부모/자식 카드 링크는 Tab 키로 포커스 이동 가능하고, Enter/Space 키로 네비게이션할 수 있다.
7. **컨텍스트 표시**: CreateCardModal에서 부모 카드 제목을 표시하여 하위 카드 생성임을 명확히 알린다.

## 비기능 요구사항

| 항목 | 기준 |
|------|------|
| 성능 | 카드 네비게이션 시 데이터 로딩 시간 < 500ms |
| 신뢰성 | 부모 카드 삭제 시 자식 카드 데이터 무결성 보장 (트랜잭션 처리) |
| 보안 | 부모 카드와 자식 카드가 동일 보드에 속하는지 검증 |
| 확장성 | 향후 2단계 이상 계층 구조 확장 가능한 데이터 모델 설계 |
| 접근성 | 부모/자식 카드 링크에 적절한 ARIA 레이블 제공 |
| 데이터 제한 | 1개 카드당 최대 자식 카드 수 제한 없음 (성능 모니터링 필요) |

## 가정 및 제약

- 계층 구조는 1단계만 지원한다 (부모 → 자식, 손자 불가).
- 1개의 자식 카드는 1개의 부모 카드만 가질 수 있다.
- 부모와 자식 카드는 동일한 보드(Board) 내에서만 연결 가능하다.
- 부모 카드 삭제 시 자식 카드는 삭제되지 않고 최상위 카드로 승격된다 (CASCADE DELETE 미사용).
- 자식 카드를 다른 칼럼으로 이동하면 부모 관계가 자동 해제된다.
- EditCardModal은 Props 기반 네비게이션 방식을 사용하여 cardId 변경 시 데이터를 재조회한다.

## 미해결 이슈

1. 자식 카드가 매우 많은 경우(예: 100개 이상) 페이지네이션 또는 무한 스크롤 적용 여부를 결정해야 한다.
2. 부모 카드와 자식 카드가 다른 칼럼에 있을 때 시각적 연결 표시 방법을 검토해야 한다.
3. 모달 네비게이션 히스토리(뒤로가기 버튼) 구현 필요성을 평가해야 한다.
4. 자식 카드 목록의 정렬 기준(생성일, 우선순위, 완료 상태)을 확정해야 한다.
5. 부모 카드 삭제 시 사용자에게 "자식 카드가 승격됩니다" 경고 메시지 표시 여부를 결정해야 한다.
6. 자식 카드 생성 시 부모 카드의 일부 속성(우선순위, 담당자) 자동 상속 여부를 검토해야 한다.
